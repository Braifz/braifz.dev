---
title: "Supabase - Edge Functions"
summary: "This tutorial is about the Edge Function in Supabase, focusing on how it works with Next.js."
date: Jun 29, 2024
author: "Braifz"
image: "/blog/blog-1.jpg"
category: "Supabase"
---

required:

- Supabase CLI
- Deno
- Docker
- Next.js
- Typescript
- Postman

---

### What is Supabase?

If youâ€™re not sure what Supabase is, you can find out on their website. They define it like this:

> _Supabase is an open source Firebase alternative.  
> Start your project with a Postgres database, Authentication, instant APIs, Edge Functions, Realtime subscriptions, Storage, and Vector embeddings._

If you want to know more about Supabase, check out [https://supabase.com/](https://supabase.com/)

### What are Supabase Edge Functions & how do they work?

And theyâ€™ve defined the Edge Functions like this:

> _Edge Functions are server-side TypeScript functions, distributed globally at the edge â€” close to your users. They can be used for listening to webhooks or integrating your Supabase project with third-parties._

These functions run custom logic on the edge, closer to where data is consumed. This reduces latency and improves performance for global apps.

### What we gonna build?

We gonna to build a next.js app with supabase, using a edge function to get data in an external api and save this data in supabase database.

You can find the code of this tutorial in this [repo](https://github.com/Braifz/edge-function-supabase).

## Let's dive in!

### Creating a Next.js project

The first thing we need to do is create a Next.js project, put this command in the console:

```plaintext
npx create-next-app@latest
```

This command will create a project of next.js, just follow the stepsâ€¦

For more details, see [here](https://nextjs.org/docs/getting-started/installation).

### Installing Supabase CLI

This command is for Window SO, if you have another OS check Supabase documentation [here](https://supabase.com/docs/guides/cli/getting-started?queryGroups=platform&platform=macos).

```plaintext
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

### Starting Supabase

Inside the folder of next.js created before, run this command:

```plaintext
supabase init
```

This will create a folder called supabase in the root of the project, within this folder will be all the related with Supabase

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719639720312/91d0b715-0ebe-464b-82ad-439a28ed5c81.webp align="center")

### Creating Edge Function

Write the following command:

```plaintext
supabase functions new [function-name]
```

This will be create a folder called /functions and inside will be all the functions we createâ€¦

I called the function _get-data-api_

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719639827944/b4091deb-d116-4b18-85d8-e6626096d721.webp align="center")

In the archive index.ts is where the logic of the edge function will be, this logic will deploy in supabase or locally if you wantâ€¦

### Creating supabase project

Go to [https://supabase.com/dashboard](https://supabase.com/dashboard) and create a new project.  
You will see something like this:

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640007710/99c930c4-da78-43a8-a4e4-048a5bef2908.webp align="center")

Fill the project name and password and create a new project.

### Enviroment variables

Now we need to save the .env in our project, go to your project settings -&gt; API -&gt; API Settings

You will look something like that:

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640067691/427dc1a3-6008-4827-a158-427fe48f60f3.webp align="center")

Create the archive .env in the root of your next.js project and copy this with yours keys:

```plaintext
NEXT_PUBLIC_SUPABASE_URL=<API_URL>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<ANON_KEY>
```

### Creating table in Supabase

Go to table editor and run this query:

```sql
create table
  public.characters (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    name text null,
    status text null,
    species text null,
    type text null,
    gender text null,
    constraint characters_pkey primary key (id)
  ) tablespace pg_default;
```

This will create a table characters where we save the data

### Write Edge Function

Copy this code in index.ts

```typescript
import axiod from "https://deno.land/x/axiod@0.26.2/mod.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2.42.0";

Deno.serve(async () => {
  const supabaseClient = createClient(
    Deno.env.get("SUPABASE_URL") ?? "",
    Deno.env.get("SUPABASE_SERVICE_ROLE_KEY") ?? ""
  );
  try {
    const data = await axiod.get("https://rickandmortyapi.com/api/character");
    const characters = data.data.results;

    if (characters) {
      // deno-lint-ignore no-explicit-any
      characters.map(async (character: any) => {
        await supabaseClient.from("characters").upsert({
          id: character.id,
          name: character.name,
          status: character.status,
          species: character.species,
          type: character.type,
          gender: character.gender,
        });
      });
    }
    return new Response("Characters saved correctly!", {
      headers: { "Content-Type": "application/json" },
      status: 200,
    });
  } catch (error) {
    return new Response(String(error?.message ?? error), { status: 500 });
  }
});
```

### Deploy Edge Function

Here we want to send this function we write to supabase and run this with a http request.

Just write this in the command line:

```plaintext
supabase login
```

This will open your browser and login with your supabase profile

Now write this command and select your project

```plaintext
supabase projects list
```

You will see something like that

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640432578/6a919c45-29de-43a1-9ac3-c150fedeb85b.webp align="center")

now we have the reference ID, we want to link this project for deploy our edge function, write:

```plaintext
supabase link --project-ref <YOUR_REFERENCE_ID>
```

If you are linking your project correctly, we are ready to deploy our edge function!ðŸŽ‰

now just write in the command line:

> _make sure you have Docker runnning_

```plaintext
supabase functions deploy <EDGE_FUNCTION_NAME>
```

Go to Supabase dashboard and you should see your edge function deployed ðŸŽ‰ðŸŽ‰

### Calling Edge Function

If you go to Supabase dashboard you should see this table, make click and you can see the information about the edge function

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640559173/ef3f4a7a-9d78-43aa-a27f-f1d457ba7029.webp align="center")

now copy the Endpoint URL

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640577588/3662c5ff-9ff0-4694-8657-ffce76de7554.webp align="center")

Now make a request Http in this case I am using [**postman**](https://www.postman.com/), make sure youâ€™re putting the bearer token correctly.

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640613232/b8bef588-6911-489a-a7fd-67f58059d666.webp align="center")

If status code is 200, congratulations! ðŸŽ‰

We are calling our edge function correctly, now go to Supabase dashboard!

you should see the table populated with the api data ðŸŽ‰

![](https://cdn.hashnode.com/res/hashnode/image/upload/v1719640632560/ee6a448e-b18d-4db1-8807-424c03240acd.webp align="center")

### Conclusion

The edge function have a powerful tool and you can do a lots of things

you now know how to use edge functions! ðŸŽ‰

Hope you enjoy this tutorial!
