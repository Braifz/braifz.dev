---
title: "Supabase - Edge Functions"
summary: "This tutorial is about the Edge Function in Supabase, focusing on how it works with Next.js."
date: Jun 29, 2024
author: "Braifz"
image: "/blog/supabase-edge-function/cover.jpg"
category: "Supabase"
order: 2
---

required:

- Supabase CLI
- Deno
- Docker
- Next.js
- Typescript
- Postman

---

### What is Supabase?

If youâ€™re not sure what Supabase is, you can find out on their website. They define it like this:

> _Supabase is an open source Firebase alternative.  
> Start your project with a Postgres database, Authentication, instant APIs, Edge Functions, Realtime subscriptions, Storage, and Vector embeddings._

If you want to know more about Supabase, check out [https://supabase.com/](https://supabase.com/)

### What are Supabase Edge Functions & how do they work?

And theyâ€™ve defined the Edge Functions like this:

> _Edge Functions are server-side TypeScript functions, distributed globally at the edge â€” close to your users. They can be used for listening to webhooks or integrating your Supabase project with third-parties._

These functions run custom logic on the edge, closer to where data is consumed. This reduces latency and improves performance for global apps.

### What are we going to build?

We are going to build a Next.js app with Supabase, using an Edge Function to fetch data from an external API and store it in the Supabase database.

You can find the code of this tutorial in this [repo](https://github.com/Braifz/edge-function-supabase).

## Let's dive in!

### Creating a Next.js project

The first thing we need to do is create a Next.js project. Run the following command in your terminal:

```shell
npx create-next-app@latest
```

This command will create a Next.js project. Just follow the stepsâ€¦

For more details, see [here](https://nextjs.org/docs/getting-started/installation).

### Installing Supabase CLI

This command is for Windows OS. If you are using another operating system, check the Supabase documentation [here](https://supabase.com/docs/guides/cli/getting-started?queryGroups=platform&platform=macos).

```shell
scoop bucket add supabase https://github.com/supabase/scoop-bucket.git
scoop install supabase
```

### Starting Supabase

Inside the Next.js project folder created earlier, run this command:

```shell
supabase init
```

This will create a folder called supabase at the root of the project. Inside this folder you will find everything related to Supabase.

![Supabase init](/blog/supabase-edge-function/supabase1.webp)

### Creating Edge Function

Run the following command:

```shell
supabase functions new [function-name]
```

This will create a /functions folder containing all the Edge Functions you create.

I called the function _get-data-api_

![](/blog/supabase-edge-function/supabase2.webp)

In the index.ts file is where the Edge Function logic lives. This logic can be deployed to Supabase or run locally.

### Creating Supabase project

Go to [https://supabase.com/dashboard](https://supabase.com/dashboard) and create a new project.  
You will see something like this:

![](/blog/supabase-edge-function/supabase3.webp)

Fill in the project name and password, then create the project.

### Environment variables

Now we need to save the .env in our project, go to your project settings -&gt; API -&gt; API Settings

You will look something like that:

![](/blog/supabase-edge-function/supabase4.webp)

Create a .env file in the root of your Next.js project and add your keys:

```shell
NEXT_PUBLIC_SUPABASE_URL=<API_URL>
NEXT_PUBLIC_SUPABASE_ANON_KEY=<ANON_KEY>
```

### Creating table in Supabase

Go to table editor and run this query:

```sql
create table
  public.characters (
    id bigint generated by default as identity,
    created_at timestamp with time zone not null default now(),
    name text null,
    status text null,
    species text null,
    type text null,
    gender text null,
    constraint characters_pkey primary key (id)
  ) tablespace pg_default;
```

This will create a table characters where we save the data

### Write Edge Function

Copy this code in index.ts

```typescript
import axiod from "https://deno.land/x/axiod@0.26.2/mod.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2.42.0";

Deno.serve(async () => {
  const supabaseClient = createClient(
    Deno.env.get("SUPABASE_URL") ?? "",
    Deno.env.get("SUPABASE_SERVICE_ROLE_KEY") ?? "",
  );
  try {
    const data = await axiod.get("https://rickandmortyapi.com/api/character");
    const characters = data.data.results;

    if (characters) {
      // deno-lint-ignore no-explicit-any
      characters.map(async (character: any) => {
        await supabaseClient.from("characters").upsert({
          id: character.id,
          name: character.name,
          status: character.status,
          species: character.species,
          type: character.type,
          gender: character.gender,
        });
      });
    }
    return new Response("Characters saved correctly!", {
      headers: { "Content-Type": "application/json" },
      status: 200,
    });
  } catch (error) {
    return new Response(String(error?.message ?? error), { status: 500 });
  }
});
```

### Deploy Edge Function

Now we want to deploy the Edge Function we wrote and trigger it via an HTTP request.

Just write this in the command line:

```shell
supabase login
```

This will open your browser and login with your supabase profile

Then list your projects and select the correct one:

```shell
supabase projects list
```

You will see something like that

![](/blog/supabase-edge-function/supabase5.webp)

now we have the reference ID, we want to link this project for deploy our edge function, write:

```shell
supabase link --project-ref <YOUR_REFERENCE_ID>
```

If you are linking your project correctly, we are ready to deploy our edge function!ðŸŽ‰

now just write in the command line:

> _make sure you have Docker runnning_

```shell
supabase functions deploy <EDGE_FUNCTION_NAME>
```

Go to Supabase dashboard and you should see your edge function deployed ðŸŽ‰ðŸŽ‰

### Calling Edge Function

If you go to Supabase dashboard you should see this table, make click and you can see the information about the edge function

![](/blog/supabase-edge-function/supabase6.webp)

now copy the Endpoint URL

![](/blog/supabase-edge-function/supabase7.webp)

Now make a request Http in this case I am using [**postman**](https://www.postman.com/), make sure youâ€™re putting the bearer token correctly.

![](/blog/supabase-edge-function/supabase8.webp)

If status code is 200, congratulations! ðŸŽ‰

We are calling our edge function correctly, now go to Supabase dashboard!

you should see the table populated with the api data ðŸŽ‰

![](/blog/supabase-edge-function/supabase9.webp)

### Conclusion

The edge function have a powerful tool and you can do a lots of things

you now know how to use edge functions! ðŸŽ‰

Hope you enjoy this tutorial!
